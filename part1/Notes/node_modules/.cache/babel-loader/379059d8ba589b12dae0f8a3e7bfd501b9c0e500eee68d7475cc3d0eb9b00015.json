{"ast":null,"code":"'use strict';\n\nconst https = require('https');\nconst FormData = require('@discordjs/form-data');\nconst AbortController = require('abort-controller');\nconst fetch = require('node-fetch');\nconst {\n  browser,\n  UserAgent\n} = require('../util/Constants');\nif (https.Agent) var agent = new https.Agent({\n  keepAlive: true\n});\nclass APIRequest {\n  constructor(rest, method, path, options) {\n    this.rest = rest;\n    this.client = rest.client;\n    this.method = method;\n    this.route = options.route;\n    this.options = options;\n    this.retries = 0;\n    let queryString = '';\n    if (options.query) {\n      const query = Object.entries(options.query).filter(_ref => {\n        let [, value] = _ref;\n        return ![null, 'null', 'undefined'].includes(value) && typeof value !== 'undefined';\n      }).flatMap(_ref2 => {\n        let [key, value] = _ref2;\n        return Array.isArray(value) ? value.map(v => [key, v]) : [[key, value]];\n      });\n      queryString = new URLSearchParams(query).toString();\n    }\n    this.path = `${path}${queryString && `?${queryString}`}`;\n  }\n  make() {\n    const API = this.options.versioned === false ? this.client.options.http.api : `${this.client.options.http.api}/v${this.client.options.http.version}`;\n    const url = API + this.path;\n    let headers = {};\n    if (this.options.auth !== false) headers.Authorization = this.rest.getAuth();\n    if (this.options.reason) headers['X-Audit-Log-Reason'] = encodeURIComponent(this.options.reason);\n    if (!browser) headers['User-Agent'] = UserAgent;\n    if (this.options.headers) headers = Object.assign(headers, this.options.headers);\n    let body;\n    if (this.options.files && this.options.files.length) {\n      body = new FormData();\n      for (const file of this.options.files) if (file && file.file) body.append(file.name, file.file, file.name);\n      if (typeof this.options.data !== 'undefined') body.append('payload_json', JSON.stringify(this.options.data));\n      if (!browser) headers = Object.assign(headers, body.getHeaders());\n      // eslint-disable-next-line eqeqeq\n    } else if (this.options.data != null) {\n      body = JSON.stringify(this.options.data);\n      headers['Content-Type'] = 'application/json';\n    }\n    const controller = new AbortController();\n    const timeout = this.client.setTimeout(() => controller.abort(), this.client.options.restRequestTimeout);\n    return fetch(url, {\n      method: this.method,\n      headers,\n      agent,\n      body,\n      signal: controller.signal\n    }).finally(() => this.client.clearTimeout(timeout));\n  }\n}\nmodule.exports = APIRequest;","map":{"version":3,"names":["https","require","FormData","AbortController","fetch","browser","UserAgent","Agent","agent","keepAlive","APIRequest","constructor","rest","method","path","options","client","route","retries","queryString","query","Object","entries","filter","value","includes","flatMap","key","Array","isArray","map","v","URLSearchParams","toString","make","API","versioned","http","api","version","url","headers","auth","Authorization","getAuth","reason","encodeURIComponent","assign","body","files","length","file","append","name","data","JSON","stringify","getHeaders","controller","timeout","setTimeout","abort","restRequestTimeout","signal","finally","clearTimeout","module","exports"],"sources":["/Users/jessegill/node_modules/discord.js/src/rest/APIRequest.js"],"sourcesContent":["'use strict';\n\nconst https = require('https');\nconst FormData = require('@discordjs/form-data');\nconst AbortController = require('abort-controller');\nconst fetch = require('node-fetch');\nconst { browser, UserAgent } = require('../util/Constants');\n\nif (https.Agent) var agent = new https.Agent({ keepAlive: true });\n\nclass APIRequest {\n  constructor(rest, method, path, options) {\n    this.rest = rest;\n    this.client = rest.client;\n    this.method = method;\n    this.route = options.route;\n    this.options = options;\n    this.retries = 0;\n\n    let queryString = '';\n    if (options.query) {\n      const query = Object.entries(options.query)\n        .filter(([, value]) => ![null, 'null', 'undefined'].includes(value) && typeof value !== 'undefined')\n        .flatMap(([key, value]) => (Array.isArray(value) ? value.map(v => [key, v]) : [[key, value]]));\n      queryString = new URLSearchParams(query).toString();\n    }\n    this.path = `${path}${queryString && `?${queryString}`}`;\n  }\n\n  make() {\n    const API =\n      this.options.versioned === false\n        ? this.client.options.http.api\n        : `${this.client.options.http.api}/v${this.client.options.http.version}`;\n    const url = API + this.path;\n    let headers = {};\n\n    if (this.options.auth !== false) headers.Authorization = this.rest.getAuth();\n    if (this.options.reason) headers['X-Audit-Log-Reason'] = encodeURIComponent(this.options.reason);\n    if (!browser) headers['User-Agent'] = UserAgent;\n    if (this.options.headers) headers = Object.assign(headers, this.options.headers);\n\n    let body;\n    if (this.options.files && this.options.files.length) {\n      body = new FormData();\n      for (const file of this.options.files) if (file && file.file) body.append(file.name, file.file, file.name);\n      if (typeof this.options.data !== 'undefined') body.append('payload_json', JSON.stringify(this.options.data));\n      if (!browser) headers = Object.assign(headers, body.getHeaders());\n      // eslint-disable-next-line eqeqeq\n    } else if (this.options.data != null) {\n      body = JSON.stringify(this.options.data);\n      headers['Content-Type'] = 'application/json';\n    }\n\n    const controller = new AbortController();\n    const timeout = this.client.setTimeout(() => controller.abort(), this.client.options.restRequestTimeout);\n    return fetch(url, {\n      method: this.method,\n      headers,\n      agent,\n      body,\n      signal: controller.signal,\n    }).finally(() => this.client.clearTimeout(timeout));\n  }\n}\n\nmodule.exports = APIRequest;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}